# Education Connect V2 - 团组管理增强版需求文档

## 项目背景

当前V1版本已实现基础的研学行程管理功能，但团组管理界面过于简单，无法满足专业化管理需求。V2版本的核心目标是**全面升级团组管理功能**，提供专业级的团组信息管理、团员管理和日程安排能力。

### 快速开始
1. 确保已经运行V1版本，熟悉现有功能
2. V2版本将创建新的路由 `/groups/v2`，不影响V1功能
3. 可以参考V1的 `GroupManagement.jsx` 文件，但V2需要完全重写

## V2版本核心定位

**V2是团组管理的专业增强版，不是简单的功能迭代**

### V1 vs V2 对比

| 功能模块 | V1版本（当前） | V2版本（目标） |
|---------|--------------|--------------|
| **团组信息** | 基础字段（名称、日期、人数） | 完整信息（预算、状态、联系人、标签等） |
| **团员管理** | 仅显示人数统计 | 完整团员名单、详细信息、角色分配 |
| **日程安排** | 简单的上午/下午时段 | Google Calendar级别的精细化日程管理 |
| **编辑方式** | 弹窗编辑基础信息 | 独立页面三部分编辑（概览/团员/日程） |
| **数据展示** | 简单列表 | 卡片式展示、多维度筛选、状态管理 |

## 功能需求详细说明

### 1. 团组管理V2主界面 `/groups/v2`

#### 1.1 增强的团组列表展示
```
卡片式布局，每个团组卡片显示：
┌─────────────────────────────────────┐
│ 深圳实验学校小学部        [进行中]    │
│ ─────────────────────────────────── │
│ 📅 2025.09.12 - 09.16 (5天)         │
│ 👥 学生: 44人 | 老师: 6人            │
│ 📍 行程完成度: 60% (3/5天)           │
│ 📋 已安排活动: 12个 | 待安排: 3个     │
│ 👤 联系人: 张老师 13800138000        │
│                                      │
│ [查看详情] [编辑团组] [导出报告]      │
└─────────────────────────────────────┘
```

#### 1.2 筛选和搜索功能
- 按状态筛选：准备中 | 进行中 | 已完成 | 已取消
- 按类型筛选：小学 | 中学
- 按日期范围筛选
- 关键词搜索（团组名称、联系人、学校）

### 2. 团组编辑页面 `/groups/v2/edit/:id`

**关键设计：独立页面，非弹窗，包含三个主要部分**

#### 2.1 页面布局
```
┌──────────────────────────────────────────────┐
│  < 返回团组列表    深圳实验学校小学部 - 编辑  │
├──────────────────────────────────────────────┤
│  [团组概览] | [团员管理] | [日程安排]         │
├──────────────────────────────────────────────┤
│                                              │
│           （标签页内容区域）                   │
│                                              │
└──────────────────────────────────────────────┘
```

#### 2.2 团组概览标签页
扩展的信息字段：
- **基础信息**：团组名称、类型、日期范围
- **状态管理**：准备中 → 进行中 → 已完成
- **联系信息**：主要联系人、紧急联系人、联系方式
- **行程信息**：总天数、已完成天数、活动统计
- **备注说明**：特殊要求、注意事项
- **标签管理**：自定义标签（如：重点团组、首次合作）

#### 2.3 团员管理标签页
完整的团员信息管理：
- **团员列表**：表格展示所有团员
- **详细信息**：姓名、性别、年龄、身份证号、联系方式
- **角色分配**：学生、带队老师、随行家长
- **批量操作**：批量导入（Excel）、批量删除
- **搜索过滤**：按姓名、角色快速查找
- **特殊标记**：过敏史、特殊需求、房间分配

#### 2.4 日程安排标签页（核心创新）

**Google Calendar风格的专业日程管理**

##### 动态天数视图设计
```
深圳实验学校小学部（9月12-16日，5天行程）

      9月12日(四)  9月13日(五)  9月14日(六)  9月15日(日)  9月16日(一)
06:00 ┌─────────┬──────────┬──────────┬──────────┬──────────┐
06:30 │         │          │          │          │          │
07:00 │ 早餐     │ 早餐      │ 早餐      │ 早餐      │ 早餐      │
07:30 │ 集合出发  │          │          │          │ 退房      │
08:00 │         │ 香港科学馆 │          │          │ 集合      │
08:30 │ 过关     │    参观   │ 海洋公园  │ 迪士尼    │          │
09:00 │         │          │   游览    │   全天    │ 返程      │
...   │   ...   │   ...    │   ...    │   ...    │   ...    │
22:00 │ 查房     │ 查房      │ 查房      │ 查房      │          │
22:30 │ 就寝     │ 就寝      │ 就寝      │ 就寝      │          │
23:00 └─────────┴──────────┴──────────┴──────────┴──────────┘
```

##### 核心交互功能
1. **创建活动**：点击任意时间格创建新活动，活动名称默认不是必填。显示未命名
2. **拖拽调整**：
   - 拖拽整个活动卡片改变时间或日期，卡片的上沿靠近的时间为准
   - 拖拽下边缘调整活动时长，调整活动时长不需要对话框确认，直接调整。（15分钟精度）
3. **活动详情**：点击活动查看/编辑详细信息
4. **冲突提示**：时间冲突自动并排显示，红色警告
5. **颜色编码**：不同类型活动用不同颜色（餐饮、交通、参观、住宿）

### 3. 数据模型扩展

#### 3.1 团组模型V2
```javascript
{
  // V1字段保留
  id, name, type, student_count, teacher_count,
  start_date, end_date, duration, color,

  // V2新增字段
  status: '准备中|进行中|已完成|已取消',
  contact_person: '张老师',
  contact_phone: '13800138000',
  emergency_contact: '李主任',
  emergency_phone: '13900139000',
  tags: ['重点团组', '首次合作'],
  notes: '学生有3名素食者，需特别安排',
  activity_count: 15,      // 总活动数
  completed_activities: 9, // 已完成活动数
  created_at: '2025-01-01',
  updated_at: '2025-01-15'
}
```

#### 3.2 团员模型
```javascript
{
  id: 1,
  group_id: 1,
  name: '张小明',
  gender: '男',
  age: 12,
  id_number: '440xxx',
  phone: '13800138001',
  parent_phone: '13800138002',
  role: '学生|老师|家长',
  room_number: '301',
  special_needs: '花生过敏',
  emergency_contact: '张妈妈'
}
```

#### 3.3 详细日程模型
```javascript
{
  id: 1,
  group_id: 1,
  date: '2025-09-12',
  start_time: '08:00',    // 精确到分钟
  end_time: '09:30',      // 支持跨时段
  title: '香港科学馆参观',
  location: '香港科学馆',
  location_id: 1,
  type: '参观|餐饮|交通|住宿|自由活动',
  description: '参观科学馆常设展览',
  participants: [1,2,3],  // 参与团员ID
  color: '#4CAF50',
  status: '已确认|待确认|已取消'
}
```

### 4. API设计

#### 4.1 团组管理API
```
GET    /api/v2/groups          # 获取团组列表（支持筛选参数）
GET    /api/v2/groups/:id      # 获取单个团组详情
POST   /api/v2/groups          # 创建新团组
PUT    /api/v2/groups/:id      # 更新团组信息
DELETE /api/v2/groups/:id      # 删除团组
POST   /api/v2/groups/:id/duplicate # 复制团组
```

#### 4.2 团员管理API
```
GET    /api/v2/groups/:id/members     # 获取团组成员列表
POST   /api/v2/groups/:id/members     # 添加成员
PUT    /api/v2/members/:id            # 更新成员信息
DELETE /api/v2/members/:id            # 删除成员
POST   /api/v2/groups/:id/members/import # 批量导入成员
```

#### 4.3 日程管理API
```
GET    /api/v2/groups/:id/schedules   # 获取团组所有日程
POST   /api/v2/schedules              # 创建日程项
PUT    /api/v2/schedules/:id          # 更新日程项
DELETE /api/v2/schedules/:id          # 删除日程项
POST   /api/v2/schedules/batch        # 批量操作日程
GET    /api/v2/schedules/conflicts    # 检查时间冲突
```

## 技术实现要求

### 前端技术栈
- **框架**：React 18 + React Router 6
- **UI库**：Ant Design 5.x
- **日历组件**：自定义开发（参考Google Calendar）
- **拖拽库**：HTML5 Drag and Drop API
- **状态管理**：React Hooks (useState, useContext)
- **样式**：CSS Modules + Ant Design 主题定制

### 后端技术栈
- **运行时**：Node.js + Express
- **数据存储**：初期内存存储，后期迁移到 PostgreSQL
- **认证**：JWT Token
- **验证**：express-validator

### 性能要求
- 日程视图支持 100+ 活动项流畅显示
- 拖拽操作响应时间 < 100ms
- 页面加载时间 < 2s
- 支持 50+ 团组同时管理

## 交付标准

### 第一阶段交付（核心功能）
- [ ] 团组管理V2列表页面
- [ ] 团组编辑页面框架（三标签页）
- [ ] 团组概览信息编辑功能
- [ ] 基础的日程显示（只读）

### 第二阶段交付（日程管理）
- [ ] Google Calendar风格日程界面
- [ ] 拖拽创建和调整活动
- [ ] 时间冲突检测和提示
- [ ] 活动详情编辑

### 第三阶段交付（完整功能）
- [ ] 团员管理完整功能
- [ ] 批量导入导出
- [ ] 报表生成
- [ ] 性能优化

## 开发优先级

1. **最高优先级**：团组管理V2界面和基础编辑功能
2. **高优先级**：Google Calendar日程管理
3. **中优先级**：团员管理功能
4. **低优先级**：报表导出、批量操作

## 注意事项

1. **向后兼容**：V2功能独立于V1，不影响现有功能
2. **渐进增强**：可以分阶段发布，每个阶段都是可用状态
3. **用户体验**：参考Google Calendar的交互设计
4. **代码质量**：模块化设计，便于后续维护和扩展

---

*本文档为V2版本核心需求，开发过程中如有疑问请及时沟通确认。*