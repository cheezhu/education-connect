# 团组管理上线检查清单
最后更新：2026-02-14
适用模块：`GroupManagementV2`（团组设置 / 准备进度 / 行程导出 / 日历规划 / 行程点 / 餐饮 / 接送站 / 团员名单 / 住宿安排）

## 1. 代码与构建
- [ ] 前端 `npm run lint` 通过
- [ ] 前端 `npm run test` 通过
- [ ] 前端 `npm run build` 通过
- [ ] 后端路由自检 `node scripts/backend-routes-selftest.cjs` 通过
- [ ] 乱码扫描 `node scripts/scan-garbled.cjs` 通过

## 2. 核心功能回归

### 2.1 团组列表与创建
- [ ] GROUPS 默认按时间倒序（最近在最上）
- [ ] 点击 `+` 创建单个团组，自动选中且进入“团组设置”
- [ ] 新建输入框默认显示占位文本“输入团组名称”
- [ ] 未输入名称时保存为“未命名团组”
- [ ] 编辑类型/人数/日期后，当前选中团组不丢失

### 2.2 团组设置
- [ ] 删除团组按钮有二次确认
- [ ] 类型支持 `primary / secondary / vip`
- [ ] 联系信息布局正常，无乱码
- [ ] 备注图片可上传、可预览、刷新后保留

### 2.3 每日卡片（餐饮/接送站）
- [ ] “不安排”规则一致：清空字段并计入完成
- [ ] “复制上一日出行安排”仅复制住宿/车辆/导游/安保，不复制三餐
- [ ] 接送站数据可编辑，备注与日历卡片同步
- [ ] 接送站仅首日/末日生效（首日=接站，末日=送站）

### 2.4 日历规划（原日历详情）
- [ ] 数据来源标签为：必去 / 餐饮 / 接送站 / 自定义
- [ ] 接送站填写时间后自动出现在日历
- [ ] 拖拽、拉伸后时间可回写到每日卡片
- [ ] 颜色选择与卡片颜色显示一致

### 2.5 行程导出
- [ ] docx 中文无乱码
- [ ] md 与 txt 导出结构一致
- [ ] 备注为空时不输出备注行

## 3. 数据一致性与接口
- [ ] `PUT /groups/:id` 修改后刷新不丢数据
- [ ] `POST /groups/:id/schedules/batch` 正常返回且无 400/500
- [ ] `GET /groups/:id/schedules` 返回 revision 头
- [ ] revision 冲突（409）时前端提示并自动刷新
- [ ] 保存失败时前端回滚到最后服务端版本

## 4. 页面与交互体验
- [ ] 所有 tab 无异常空白滚动条
- [ ] `/designer` 右侧可滚动到全部内容
- [ ] 中文输入（含输入法）无明显闪烁、丢字
- [ ] 移动端打开导出文档可读性可接受

## 5. 观测与应急
- [ ] 后端日志可定位关键错误（保存失败、冲突、上传失败）
- [ ] 上线前备份 SQLite 与上传目录
- [ ] 已准备回滚脚本与上一个稳定 commit

## 6. 上线后 24 小时观察指标
- [ ] 新建团组成功率
- [ ] 团组保存失败率
- [ ] 日历批量保存失败率
- [ ] 图片上传失败率
- [ ] 导出失败率（docx / md / txt）
