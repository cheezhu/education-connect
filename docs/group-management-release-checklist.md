# 团组管理上线检查清单

最后更新：2026-02-12
适用模块：`GroupManagementV2`（团组信息 / 每日卡片 / 日历详情 / 行程详情）

## 1. 代码与构建

- [ ] 前端本地测试通过：`npm test`（包含 `useGroupData` 与 `index` smoke tests）。
- [ ] 前端生产构建通过：`npm run build`。
- [ ] 关键入口无控制台报错（打开 `/groups`，切换全部 tab 一次）。
- [ ] 当前分支没有误改不相关模块（特别是旧版 GroupEditV2 页面）。

## 2. 核心功能回归

### 2.1 团组列表与创建

- [ ] 左侧 GROUPS 默认按创建时间倒序展示（最新在最上）。
- [ ] 点击 `+` 创建单个团组，自动选中该团组并进入“团组信息”tab。
- [ ] 新建团组名称输入框显示占位“输入团组名称”。
- [ ] 未输入名称时保存为“未命名团组”。
- [ ] 修改团组类型 / 人数 / 日期后，左侧当前选中项不丢失。

### 2.2 团组信息

- [ ] 删除团组按钮可用，二次确认后才执行删除。
- [ ] 联系信息在底部，布局正常，无乱码文本。
- [ ] 团组状态切换（自动/准备中/进行中/已完成/已取消）可保存。
- [ ] 备注图片可上传、可预览、刷新后仍存在。

### 2.3 每日卡片（原旅行资源）

- [ ] “不安排”规则一致：点击后字段清空，录入状态记为完成。
- [ ] 三餐“不安排”时显示“已标记不安排”样式。
- [ ] “复制上一日出行安排”仅复制住宿/车辆/导游/安保，不复制三餐。
- [ ] 接送站字段可编辑，备注与日历接送站卡片互通。

### 2.4 日历详情

- [ ] 数据来源标签包含：必去 / 餐饮 / 接送站 / 自定义。
- [ ] 接送站仅在首日/末日可生效，填入时间后自动出现在日历。
- [ ] 日历拖动与拉伸后，时间可回写每日卡片（含接送站）。
- [ ] 日历卡片颜色可选，拖回资源库后颜色不丢失。

### 2.5 行程详情导出

- [ ] `docx` 可正常导出，中文不乱码。
- [ ] 导出 `md` 与 `txt` 内容结构一致。
- [ ] 备注为空时，导出文档不出现备注行。

## 3. 数据一致性与接口

- [ ] 修改团组基础字段后，刷新页面数据不丢失。
- [ ] 修改每日卡片后，刷新后日历与每日卡片仍一一对应。
- [ ] 删除日历中的映射卡片后，每日卡片同步删除对应项（按当前规则验证）。
- [ ] API 无 `400/500` 异常（重点看 `/groups`、`/logistics`、`/schedules/batch`）。
- [ ] 实时推送下两个窗口同时编辑，冲突提示符合预期（`revision` 409）。

## 4. 页面体验与可用性

- [ ] 团组管理所有 tab 无右侧异常空白滚动条。
- [ ] `/designer` 右侧资源区可滚动，能看到“每日关注”等下方内容。
- [ ] 输入中文（尤其每日卡片）无明显闪烁和丢字。
- [ ] 移动端打开导出 `docx` 可读性可接受（字体/段落不挤压）。

## 5. 观测与应急

- [ ] 后端日志已记录关键错误（保存失败、冲突、上传失败）。
- [ ] 部署前备份数据库文件（当前 SQLite）与上传目录。
- [ ] 可执行快速回滚：回滚到上一个稳定镜像 + 数据库恢复流程已演练。

## 6. 上线后 24 小时观察

- [ ] 新建团组成功率。
- [ ] 团组保存失败率（`PUT /groups/:id`）。
- [ ] 日历批量保存失败率（`POST /groups/:id/schedules/batch`）。
- [ ] 图片上传失败率。
- [ ] 导出失败率（docx/md/txt）。

