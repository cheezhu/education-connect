<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EC Pro Workstation - Interactive Prototype</title>
    <style>
        :root {
            --bg-app: #1e1e1e;
            --bg-activity: #333333;
            --bg-sidebar: #252526;
            --bg-editor: #1e1e1e;
            --bg-header: #2d2d2d;
            --bg-status: #007acc;
            --bg-panel: #1e1e1e;
            --bg-menu: #252526;
            
            --border-color: #454545;
            --text-main: #cccccc;
            --text-muted: #858585;
            --accent: #0e639c;
            --selection: rgba(14, 99, 156, 0.4);
            
            --color-conflict: #f14c4c;
            --color-warning: #cca700;
            --color-success: #89d185;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', 'SF Pro Text', Consolas, sans-serif;
            font-size: 13px;
            color: var(--text-main);
            background: var(--bg-app);
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* Â∏ÉÂ±Ä */
        .app-shell { display: flex; height: 100vh; width: 100vw; }
        .vertical-split { display: flex; flex-direction: column; flex: 1; min-width: 0; }
        .horizontal-split { display: flex; flex: 1; min-height: 0; }

        /* 1. Activity Bar */
        .activity-bar { width: 48px; background: var(--bg-activity); display: flex; flex-direction: column; align-items: center; padding-top: 10px; z-index: 100; }
        .activity-item { width: 48px; height: 48px; display: flex; justify-content: center; align-items: center; color: var(--text-muted); font-size: 20px; border-left: 2px solid transparent; cursor: pointer; position: relative; }
        .activity-item:hover, .activity-item.active { color: white; opacity: 1; }
        .activity-item.active { border-left-color: white; }
        .badge { position: absolute; bottom: 10px; right: 10px; width: 8px; height: 8px; background: var(--color-conflict); border-radius: 50%; border: 1px solid var(--bg-activity); }

        /* 2. Sidebar */
        .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; transition: width 0.1s; }
        .sidebar-header { height: 35px; padding: 0 16px; display: flex; align-items: center; justify-content: space-between; font-size: 11px; font-weight: bold; color: var(--text-muted); text-transform: uppercase; }
        .sidebar-search { padding: 8px 12px; border-bottom: 1px solid var(--border-color); }
        .search-input { width: 100%; background: #3c3c3c; border: 1px solid transparent; color: white; padding: 4px 8px; border-radius: 2px; font-size: 12px; }
        .search-input:focus { border-color: var(--accent); outline: none; }
        
        .panel-section { border-bottom: 1px solid var(--border-color); }
        .panel-header { padding: 6px 10px; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: space-between; color: #e0e0e0; background: rgba(255,255,255,0.03); }
        .panel-header:hover { background: #2a2d2e; }
        
        .group-item { padding: 4px 10px 4px 12px; cursor: pointer; display: flex; align-items: center; gap: 8px; position: relative; }
        .group-item:hover { background: #2a2d2e; }
        .group-item.hidden { opacity: 0.5; }
        .eye-icon { margin-left: auto; color: #666; font-size: 12px; opacity: 0; }
        .group-item:hover .eye-icon { opacity: 1; }
        .group-color { width: 8px; height: 8px; border-radius: 50%; }

        /* 3. Main Stage */
        .main-stage { flex: 1; display: flex; flex-direction: column; background: var(--bg-editor); min-width: 0; position: relative; }
        .top-bar { height: 40px; background: var(--bg-header); display: flex; align-items: center; padding: 0 16px; gap: 16px; }
        .breadcrumbs { display: flex; gap: 8px; font-size: 13px; color: var(--text-muted); }
        .crumb.active { color: white; }

        /* 4. Canvas */
        .timeline-container { flex: 1; overflow: auto; position: relative; display: flex; flex-direction: column; scroll-behavior: smooth; }
        .grid-header { display: grid; grid-template-columns: 80px repeat(7, 1fr); position: sticky; top: 0; z-index: 10; background: var(--bg-editor); border-bottom: 1px solid var(--border-color); }
        .grid-cell-header { padding: 8px; text-align: center; border-right: 1px solid #333; display: flex; flex-direction: column; }
        .grid-cell-header.today { background: rgba(14, 99, 156, 0.1); border-bottom: 2px solid var(--accent); }

        .grid-row { display: grid; grid-template-columns: 80px repeat(7, 1fr); border-bottom: 1px solid #333; min-height: 120px; }
        .time-label { padding: 10px; color: var(--text-muted); font-size: 12px; border-right: 1px solid #333; display: flex; align-items: center; justify-content: center; writing-mode: vertical-rl; background: #252526; }
        
        .grid-cell { border-right: 1px solid #333; padding: 6px; position: relative; transition: background 0.1s; }
        .grid-cell:hover { background: #222; }
        .grid-cell.highlight-flash { animation: flash 1s ease; }
        
        @keyframes flash {
            0% { background: rgba(14, 99, 156, 0.5); }
            100% { background: transparent; }
        }

        /* Task Card */
        .task-card { background: #2d2d2d; border-left: 3px solid #666; padding: 6px; margin-bottom: 6px; border-radius: 2px; cursor: pointer; transition: all 0.1s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .task-card:hover { background: #383838; transform: translateY(-1px); z-index: 5; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        .task-card.selected { border: 1px solid var(--accent); background: #303035; box-shadow: 0 0 0 1px var(--accent); }
        .task-card.hidden { display: none; }
        
        .card-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
        .card-title { font-weight: 600; color: #ddd; font-size: 11px; }
        .card-loc { font-family: Consolas, monospace; color: #8ec3eb; font-size: 10px; }
        .card-icons { display: flex; gap: 4px; margin-top: 4px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 2px; }
        .icon-tag { font-size: 9px; padding: 1px 3px; border-radius: 2px; background: #444; color: #aaa; }
        
        .task-card.conflict { border-left-color: var(--color-conflict); background: rgba(241, 76, 76, 0.05); }
        .task-card.conflict.selected { border: 1px solid var(--color-conflict); box-shadow: 0 0 0 1px var(--color-conflict); }

        /* 5. Bottom Panel */
        .bottom-panel { height: 150px; background: var(--bg-panel); border-top: 1px solid var(--border-color); display: flex; flex-direction: column; transition: height 0.2s; }
        .panel-tabs { display: flex; background: #252526; height: 30px; align-items: center; padding-left: 10px; }
        .panel-tab { padding: 0 12px; height: 100%; display: flex; align-items: center; font-size: 11px; color: #888; cursor: pointer; }
        .panel-tab.active { color: white; border-bottom: 1px solid var(--accent); background: #1e1e1e; }
        .panel-body { flex: 1; overflow: auto; padding: 0; font-family: Consolas, monospace; font-size: 12px; color: #ccc; }
        
        .problem-item { padding: 4px 12px; border-bottom: 1px solid #2a2a2a; display: flex; cursor: pointer; }
        .problem-item:hover { background: #2a2a2a; }
        .problem-icon { margin-right: 8px; color: var(--color-conflict); }
        .problem-loc { color: #8ec3eb; margin-left: auto; font-size: 11px; }

        /* 6. Inspector */
        .inspector { width: 280px; background: var(--bg-sidebar); border-left: 1px solid var(--border-color); display: flex; flex-direction: column; }
        .inspector-content { padding: 16px; }
        .prop-row { margin-bottom: 12px; }
        .prop-key { color: #888; font-size: 11px; margin-bottom: 4px; display: block; }
        .input-dark { width: 100%; background: #3c3c3c; border: 1px solid #444; color: white; padding: 6px; font-size: 12px; border-radius: 2px; }
        .input-dark:focus { border-color: var(--accent); outline: none; }
        
        .empty-state { text-align: center; color: #666; margin-top: 50px; font-style: italic; }

        /* Toast */
        .toast { position: fixed; bottom: 30px; right: 30px; background: #333; color: white; padding: 10px 20px; border-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); transform: translateY(100px); transition: transform 0.3s; z-index: 1000; display: flex; align-items: center; gap: 8px; border-left: 4px solid var(--color-success); }
        .toast.visible { transform: translateY(0); }
    </style>
</head>
<body oncontextmenu="return false;">

    <div class="app-shell">
        <!-- Activity Bar -->
        <div class="activity-bar">
            <div class="activity-item active" title="Explorer">üìÑ</div>
            <div class="activity-item" title="Search">üîç</div>
            <div class="activity-item" title="Source Control">üì¶</div>
            <div class="activity-item" style="margin-top: auto;">‚öôÔ∏è</div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">EXPLORER</div>
            <div class="sidebar-search">
                <input type="text" class="search-input" placeholder="Filter groups..." onkeyup="filterGroups(this.value)">
            </div>
            <div class="sidebar-content" id="groupList">
                <div class="panel-section">
                    <div class="panel-header"><span>OPEN GROUPS</span></div>
                    <div style="padding: 4px 0;">
                        <!-- Groups injected by JS -->
                    </div>
                </div>
            </div>
        </div>

        <div class="vertical-split">
            <!-- Main Stage -->
            <div class="horizontal-split">
                <div class="main-stage">
                    <div class="top-bar">
                        <div class="breadcrumbs">
                            <span class="crumb active">Itinerary Designer</span>
                        </div>
                    </div>

                    <div class="timeline-container" id="canvas">
                        <div class="grid-header">
                            <div class="grid-cell-header"></div>
                            <div class="grid-cell-header"><div>Mon</div><div style="font-size:16px; color:#fff">12</div></div>
                            <div class="grid-cell-header today"><div>Tue</div><div style="font-size:16px; color:var(--accent)">13</div></div>
                            <div class="grid-cell-header"><div>Wed</div><div style="font-size:16px; color:#fff">14</div></div>
                            <div class="grid-cell-header"><div>Thu</div><div style="font-size:16px; color:#fff">15</div></div>
                            <div class="grid-cell-header"><div>Fri</div><div style="font-size:16px; color:#fff">16</div></div>
                            <div class="grid-cell-header"><div>Sat</div><div style="font-size:16px; color:#fff">17</div></div>
                            <div class="grid-cell-header"><div>Sun</div><div style="font-size:16px; color:#fff">18</div></div>
                        </div>

                        <!-- Grid generated by JS -->
                        <div id="gridContent"></div>
                    </div>
                </div>

                <!-- Inspector -->
                <div class="inspector">
                    <div class="sidebar-header">INSPECTOR</div>
                    <div id="inspectorContent" class="inspector-content">
                        <div class="empty-state">Select an activity to edit properties.</div>
                    </div>
                </div>
            </div>

            <!-- Bottom Panel -->
            <div class="bottom-panel">
                <div class="panel-tabs">
                    <div class="panel-tab active">PROBLEMS <span class="badge-count" style="background:#f14c4c; color:white; border-radius:8px; padding:0 4px; font-size:9px; margin-left:4px">1</span></div>
                    <div class="panel-tab">OUTPUT</div>
                </div>
                <div class="panel-body">
                    <div class="problem-item" onclick="focusConflict()">
                        <span class="problem-icon">‚ìß</span>
                        <span>Capacity Exceeded: ÁßëÊäÄÈ¶ÜA (85/50)</span>
                        <span class="problem-loc">Mon, Morning</span>
                    </div>
                </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar" style="height:22px; background:#007acc; color:white; display:flex; align-items:center; padding:0 10px; font-size:11px;">
                <div style="flex:1">Ready</div>
                <div>Ln 1, Col 1</div>
            </div>
        </div>
    </div>

    <div id="toast" class="toast">
        <span>‚úÖ</span> <span>Changes Saved</span>
    </div>

    <script>
        // --- Ê®°ÊãüÊï∞ÊçÆ ---
        const groups = [
            { id: 'g1', name: 'Ê∑±Âú≥ÂÆûÈ™å‰∏≠Â≠¶', color: '#1890ff', count: 45 },
            { id: 'g2', name: 'ÂπøÂ∑ûÂ§©Ê≤≥Â∞èÂ≠¶', color: '#52c41a', count: 32 },
            { id: 'g3', name: 'ÂåóÂ∏àÂ§ßÈôÑ‰∏≠', color: '#722ed1', count: 28 },
            { id: 'g4', name: 'Ê≠¶Ê±âÂçé‰∏≠ÈôÑ‰∏≠', color: '#fa8c16', count: 50 }
        ];

        const activities = [
            { id: 'a1', groupId: 'g1', day: 0, slot: 'MORNING', loc: 'ÁßëÊäÄÈ¶ÜA', notes: 'Food, Bus' },
            { id: 'a2', groupId: 'g2', day: 0, slot: 'AFTERNOON', loc: 'Ê§çÁâ©Âõ≠', notes: '' },
            { id: 'a3', groupId: 'g1', day: 1, slot: 'MORNING', loc: 'ÁßëÊäÄÈ¶ÜA', notes: 'Conflict!', isConflict: true },
            { id: 'a4', groupId: 'g3', day: 2, slot: 'MORNING', loc: 'ÂàõÂÆ¢ÂÆ§', notes: '' }
        ];

        // --- Áä∂ÊÄÅ ---
        let selectedId = null;

        // --- ÂàùÂßãÂåñ ---
        function init() {
            renderSidebar();
            renderGrid();
        }

        // --- Ê∏≤Êüì‰æßËæπÊ†è ---
        function renderSidebar() {
            const container = document.querySelector('#groupList .panel-section div');
            container.innerHTML = groups.map(g => `
                <div class="group-item" data-id="${g.id}" onclick="toggleGroup('${g.id}')">
                    <div class="group-color" style="background:${g.color}"></div>
                    <span>${g.name}</span>
                    <span class="eye-icon">üëÅ</span>
                </div>
            `).join('');
        }

        // --- Á≠õÈÄâÂõ¢ÁªÑ ---
        function filterGroups(val) {
            const items = document.querySelectorAll('.group-item');
            val = val.toLowerCase();
            items.forEach(item => {
                const text = item.innerText.toLowerCase();
                item.style.display = text.includes(val) ? 'flex' : 'none';
            });
        }

        // --- ÂàáÊç¢Âõ¢ÁªÑÊòæÁ§∫ ---
        function toggleGroup(gid) {
            const el = document.querySelector(`.group-item[data-id="${gid}"]`);
            el.classList.toggle('hidden');
            const isHidden = el.classList.contains('hidden');
            
            // ÈöêËóèÊâÄÊúâËØ•Âõ¢ÁªÑÁöÑÂç°Áâá
            document.querySelectorAll(`.task-card[data-gid="${gid}"]`).forEach(card => {
                card.classList.toggle('hidden', isHidden);
            });
        }

        // --- Ê∏≤ÊüìÁΩëÊ†º ---
        function renderGrid() {
            const container = document.getElementById('gridContent');
            const slots = ['MORNING', 'AFTERNOON'];
            
            let html = '';
            slots.forEach(slot => {
                html += `<div class="grid-row">
                    <div class="time-label" style="border-left: 3px solid ${slot==='MORNING'?'#1890ff':'#52c41a'}">${slot}</div>`;
                
                for(let day=0; day<7; day++) {
                    const cellActs = activities.filter(a => a.day === day && a.slot === slot);
                    html += `<div class="grid-cell" id="cell-${day}-${slot}">`;
                    
                    cellActs.forEach(act => {
                        const group = groups.find(g => g.id === act.groupId);
                        html += `
                            <div class="task-card ${act.isConflict ? 'conflict' : ''}" 
                                 data-id="${act.id}" data-gid="${act.groupId}"
                                 onclick="selectActivity(event, '${act.id}')"
                                 style="border-left-color: ${act.isConflict ? '#f14c4c' : group.color}">
                                <div class="card-row">
                                    <span class="card-title" style="${act.isConflict?'color:#ff8888':''}">${group.name}</span>
                                </div>
                                <div class="card-row">
                                    <span class="card-loc">${act.loc}</span>
                                    <span>${group.count}p</span>
                                </div>
                                ${act.notes ? `<div class="card-icons"><span class="icon-tag">${act.notes}</span></div>` : ''}
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                html += `</div>`;
            });
            container.innerHTML = html;
        }

        // --- ÈÄâ‰∏≠Ê¥ªÂä® & Ê∏≤ÊüìÂ±ûÊÄßÈù¢Êùø ---
        function selectActivity(e, aid) {
            e.stopPropagation();
            selectedId = aid;
            
            // È´ò‰∫Æ UI
            document.querySelectorAll('.task-card').forEach(c => c.classList.remove('selected'));
            const card = document.querySelector(`.task-card[data-id="${aid}"]`);
            if(card) card.classList.add('selected');

            // Ê∏≤Êüì Inspector
            const act = activities.find(a => a.id === aid);
            const group = groups.find(g => g.id === act.groupId);
            const container = document.getElementById('inspectorContent');
            
            if (act.isConflict) {
                 container.innerHTML = `
                    <div style="background:#3a2525; border:1px solid #f14c4c; padding:10px; border-radius:4px; margin-bottom:10px">
                        <div style="color:#ff8888; font-weight:bold; margin-bottom:4px">‚ùå Conflict Detected</div>
                        <div style="font-size:11px; color:#ccc">Location capacity exceeded.</div>
                    </div>
                    <div class="prop-row"><span class="prop-key">Name</span><input class="input-dark" value="${group.name}"></div>
                    <button class="input-dark" style="background:#0e639c; margin-top:10px" onclick="showToast()">Auto Fix</button>
                `;
            } else {
                container.innerHTML = `
                    <div class="prop-row">
                        <span class="prop-key">Group Name</span>
                        <input type="text" class="input-dark" value="${group.name}">
                    </div>
                    <div class="prop-row">
                        <span class="prop-key">Location</span>
                        <select class="input-dark">
                            <option>${act.loc}</option>
                            <option>Ê§çÁâ©Âõ≠</option>
                            <option>ÂàõÂÆ¢ÂÆ§</option>
                        </select>
                    </div>
                    <div class="prop-row">
                        <span class="prop-key">People</span>
                        <input type="number" class="input-dark" value="${group.count}">
                    </div>
                    <button class="input-dark" style="background:#0e639c; margin-top:10px" onclick="showToast()">Save Changes</button>
                `;
            }
        }

        // --- ÂÆö‰ΩçÂÜ≤Á™Å ---
        function focusConflict() {
            const conflictAct = activities.find(a => a.isConflict);
            if (conflictAct) {
                // Ê®°ÊãüÊªöÂä®
                const card = document.querySelector(`.task-card[data-id="${conflictAct.id}"]`);
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                // ÈÄâ‰∏≠
                selectActivity(new Event('click'), conflictAct.id);
                // Èó™ÁÉÅÂä®Áîª
                card.parentElement.classList.add('highlight-flash');
                setTimeout(() => card.parentElement.classList.remove('highlight-flash'), 1000);
            }
        }

        // --- Toast ---
        function showToast() {
            const t = document.getElementById('toast');
            t.classList.add('visible');
            setTimeout(() => t.classList.remove('visible'), 2000);
        }

        // --- Âø´Êç∑ÈîÆ ---
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Delete' && selectedId) {
                const card = document.querySelector(`.task-card[data-id="${selectedId}"]`);
                if(card) {
                    card.style.opacity = '0';
                    setTimeout(() => card.remove(), 200);
                    document.getElementById('inspectorContent').innerHTML = '<div class="empty-state">Deleted.</div>';
                    selectedId = null;
                }
            }
        });

        // ÂêØÂä®
        init();

    </script>
</body>
</html>